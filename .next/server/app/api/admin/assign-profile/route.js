"use strict";(()=>{var e={};e.id=1607,e.ids=[1607],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},24989:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>w,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>c,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{POST:()=>l}),r(95655);var a=r(83323),n=r(54647),i=r(66886),o=r(93439);async function l(e){try{let{maleUserId:t,femaleUserId:r,bulk:s=!1,assignments:a=[]}=await e.json();if(s&&a.length>0)return await u(a);if(!t||!r)return i.Z.json({error:"Both male and female user IDs are required"},{status:400});let n=await m(t,r);return n}catch(e){return console.error("Assign profile error:",e),i.Z.json({error:"Internal server error"},{status:500})}}async function u(e){try{console.log(`ðŸš€ Starting bulk assignment for ${e.length} assignments...`);let t=Array.from(new Set(e.map(e=>e.maleUserId)));Array.from(new Set(e.map(e=>e.femaleUserId)));let{data:r,error:s}=await o.p.from("users").select("id, payment_confirmed, subscription_status, full_name").in("id",t).eq("payment_confirmed",!0).eq("subscription_status","active");if(s)throw Error(`Male users validation failed: ${s.message}`);let a=new Set(r?.map(e=>e.id)||[]),{data:n}=await o.p.from("profile_assignments").select("male_user_id, female_user_id"),l=new Set(n?.map(e=>`${e.male_user_id}-${e.female_user_id}`)||[]),u=e.filter(e=>{let t=a.has(e.maleUserId),r=`${e.maleUserId}-${e.femaleUserId}`,s=!l.has(r);return t&&s});if(0===u.length)return i.Z.json({error:"No valid assignments to create",validCount:0,totalCount:e.length},{status:400});let m=u.map(e=>({male_user_id:e.maleUserId,female_user_id:e.femaleUserId,status:"assigned",male_revealed:!1,female_revealed:!1,assigned_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{data:d,error:p}=await o.p.from("profile_assignments").insert(m).select();if(p)throw Error(`Bulk insert failed: ${p.message}`);return console.log(`âœ… Bulk assignment completed: ${d?.length||0}/${e.length} assignments created`),i.Z.json({success:!0,message:`Bulk assignment completed: ${d?.length||0} assignments created`,validCount:d?.length||0,totalCount:e.length,skippedCount:e.length-(d?.length||0)})}catch(t){return console.error("Bulk assignment error:",t),i.Z.json({error:`Bulk assignment failed: ${t instanceof Error?t.message:"Unknown error"}`,validCount:0,totalCount:e.length},{status:500})}}async function m(e,t){let{data:r,error:s}=await o.p.from("users").select("payment_confirmed, subscription_status, full_name").eq("id",e).single();if(s||!r)return i.Z.json({error:"Male user not found"},{status:404});if(!r.payment_confirmed)return i.Z.json({error:`Cannot assign profile to ${r.full_name}. Payment not yet confirmed.`},{status:400});if("active"!==r.subscription_status)return i.Z.json({error:`Cannot assign profile to ${r.full_name}. Subscription is not active.`},{status:400});let{data:a}=await o.p.from("profile_assignments").select("id").eq("male_user_id",e).eq("female_user_id",t).maybeSingle();if(a)return i.Z.json({error:"Assignment already exists between these users"},{status:400});let n={male_user_id:e,female_user_id:t,status:"assigned",male_revealed:!1,female_revealed:!1,assigned_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:l,error:u}=await o.p.from("profile_assignments").insert(n).select().single();return u?(console.error("Assignment creation error:",u),i.Z.json({error:"Failed to create assignment"},{status:500})):i.Z.json({success:!0,assignment:l,message:"Profile assigned successfully"})}let d=a.AppRouteRouteModule,p=new d({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/assign-profile/route",pathname:"/api/admin/assign-profile",filename:"route",bundlePath:"app/api/admin/assign-profile/route"},resolvedPagePath:"/home/aman/Desktop/cufy_3.1v-1/app/api/admin/assign-profile/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:c,headerHooks:_,staticGenerationBailout:h}=p,w="/api/admin/assign-profile/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9195,6886,3433,7221],()=>r(24989));module.exports=s})();