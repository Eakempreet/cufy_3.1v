"use strict";(()=>{var e={};e.id=4765,e.ids=[4765],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},40030:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>q,originalPathname:()=>j,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>_});var s={};t.r(s),t.d(s,{GET:()=>l,POST:()=>c,PUT:()=>m}),t(95655);var n=t(83323),o=t(54647),i=t(66886),a=t(3471),u=t(69542),p=t(93439);async function c(e){try{let r=await (0,a.getServerSession)(u.L);if(!r?.user?.email||"cufy.online@gmail.com"!==r.user.email)return i.Z.json({error:"Unauthorized"},{status:401});let{userId:t,action:s}=await e.json();if(!t||!s)return i.Z.json({error:"Missing required fields"},{status:400});if("confirm"===s){let{error:e}=await p.p.from("users").update({payment_confirmed:!0,subscription_status:"active"}).eq("id",t);if(e)return console.error("Error confirming payment:",e),i.Z.json({error:"Failed to confirm payment"},{status:500});return i.Z.json({success:!0,message:"Payment confirmed successfully"})}return i.Z.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Error in payments API:",e),i.Z.json({error:"Internal server error"},{status:500})}}async function l(e){try{let e=await (0,a.getServerSession)(u.L);if(!e?.user?.email||"cufy.online@gmail.com"!==e.user.email)return i.Z.json({error:"Unauthorized"},{status:401});let{data:r,error:t}=await p.p.from("users").select("*").eq("gender","male").not("subscription_type","is",null).order("created_at",{ascending:!1});if(t)return console.error("Fetch users error:",t),i.Z.json({users:[]});let s=(r||[]).map(e=>({id:e.id,email:e.email,full_name:e.full_name,age:e.age,gender:e.gender,university:e.university,profile_photo:e.profile_photo,bio:e.bio,created_at:e.created_at,subscription_type:e.subscription_type,subscription_status:e.subscription_status||"pending",payment_confirmed:e.payment_confirmed||!1,payment_proof_url:e.payment_proof_url,rounds_count:0}));return i.Z.json({users:s})}catch(e){return console.error("Get payments error:",e),i.Z.json({users:[]})}}async function m(e){try{let r=await (0,a.getServerSession)(u.L);if(!r?.user?.email||"cufy.online@gmail.com"!==r.user.email)return i.Z.json({error:"Unauthorized"},{status:401});let{userId:t,action:s}=await e.json();if(!t||!s)return i.Z.json({error:"Missing required fields"},{status:400});if("confirm"===s){let{error:e}=await p.p.from("users").update({payment_confirmed:!0,subscription_status:"active"}).eq("id",t);if(e)return console.error("Error confirming payment:",e),i.Z.json({error:"Failed to confirm payment"},{status:500});return i.Z.json({success:!0,message:"Payment confirmed successfully"})}return i.Z.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Error in payments API:",e),i.Z.json({error:"Internal server error"},{status:500})}}let d=n.AppRouteRouteModule,f=new d({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/payments/route",pathname:"/api/admin/payments",filename:"route",bundlePath:"app/api/admin/payments/route"},resolvedPagePath:"/home/aman/Desktop/cufy_3.1v/app/api/admin/payments/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:x,headerHooks:q,staticGenerationBailout:_}=f,j="/api/admin/payments/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4650,8336,6886,3433,3810,3471,7221,4901,9542],()=>t(40030));module.exports=s})();