"use strict";(()=>{var e={};e.id=6253,e.ids=[6253],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},20543:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>c,originalPathname:()=>g,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>_});var s={};t.r(s),t.d(s,{POST:()=>l}),t(95655);var a=t(83323),n=t(54647),i=t(66886),o=t(93439);async function l(e){try{let{userId:r}=await e.json();if(!r)return i.Z.json({error:"User ID is required"},{status:400});let{data:t,error:s}=await o.p.from("users").select("*").eq("id",r).single();if(s||!t)return i.Z.json({error:"User not found"},{status:404});if(!t.payment_confirmed)return i.Z.json({error:`Cannot assign profile to ${t.full_name}. Payment not yet confirmed.`},{status:400});if("none"===t.subscription_type)return i.Z.json({error:`Cannot assign profile to ${t.full_name}. No active subscription.`},{status:400});let{data:a}=await o.p.from("profile_assignments").select("id").or(`male_user_id.eq.${r},female_user_id.eq.${r}`).eq("status","assigned").single();if(a)return i.Z.json({error:`${t.full_name} already has an active assignment`},{status:400});let n=null;if("male"===t.gender){let{data:e,error:r}=await o.p.from("users").select("*").eq("gender","female").eq("payment_confirmed",!0).neq("subscription_type","none").not("id","in",`(
          SELECT COALESCE(male_user_id, female_user_id) 
          FROM profile_assignments 
          WHERE status = 'assigned'
        )`);if(r)return console.error("Error fetching female users:",r),i.Z.json({error:"Error finding compatible profiles"},{status:500});n=e?.[0]}else if("female"===t.gender){let{data:e,error:r}=await o.p.from("users").select("*").eq("gender","male").eq("payment_confirmed",!0).neq("subscription_type","none").not("id","in",`(
          SELECT COALESCE(male_user_id, female_user_id) 
          FROM profile_assignments 
          WHERE status = 'assigned'
        )`);if(r)return console.error("Error fetching male users:",r),i.Z.json({error:"Error finding compatible profiles"},{status:500});n=e?.[0]}if(!n)return i.Z.json({error:`No compatible ${"male"===t.gender?"female":"male"} profiles available for assignment`},{status:404});let l={male_user_id:"male"===t.gender?r:n.id,female_user_id:"female"===t.gender?r:n.id,status:"assigned",male_revealed:!1,female_revealed:!1,assigned_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:u,error:m}=await o.p.from("profile_assignments").insert(l).select().single();if(m)return console.error("Assignment creation error:",m),i.Z.json({error:"Failed to create assignment"},{status:500});let d={assignment_id:u.id,male_user_id:u.male_user_id,female_user_id:u.female_user_id,status:"active",created_at:new Date().toISOString(),expires_at:new Date(Date.now()+1728e5).toISOString()},{error:p}=await o.p.from("temporary_matches").insert(d);return p&&console.error("Temporary match creation error:",p),i.Z.json({success:!0,assignment:u,message:`Successfully assigned ${t.full_name} to ${n.full_name}!`})}catch(e){return console.error("Auto assign error:",e),i.Z.json({error:"Internal server error"},{status:500})}}let u=a.AppRouteRouteModule,m=new u({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/assignments/create/route",pathname:"/api/admin/assignments/create",filename:"route",bundlePath:"app/api/admin/assignments/create/route"},resolvedPagePath:"/home/aman/Desktop/cufy_3.1v-1/app/api/admin/assignments/create/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:f,headerHooks:c,staticGenerationBailout:_}=m,g="/api/admin/assignments/create/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9195,6886,3433,7221],()=>t(20543));module.exports=s})();