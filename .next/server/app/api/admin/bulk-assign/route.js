"use strict";(()=>{var e={};e.id=1430,e.ids=[1430],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},78408:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>k,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>_});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>l}),r(95655);var a=r(83323),n=r(54647),i=r(66886),o=r(93439);async function l(e){try{let{assignments:t,options:r={}}=await e.json();if(!t||!Array.isArray(t)||0===t.length)return i.Z.json({error:"Assignments array is required and cannot be empty"},{status:400});let{skipValidation:s=!1,maxBatchSize:a=100,skipExistingCheck:n=!1}=r;console.log(`ðŸš€ Starting bulk assignment for ${t.length} assignments...`);let o=Date.now(),l=[];for(let e=0;e<t.length;e+=a)l.push(t.slice(e,e+a));let d=0,m=0,c=[];for(let e=0;e<l.length;e++){let t=l[e];console.log(`ðŸ“¦ Processing batch ${e+1}/${l.length} with ${t.length} assignments...`);try{let e=await u(t,{skipValidation:s,skipExistingCheck:n});d+=e.created,m+=e.skipped,e.errors&&c.push(...e.errors)}catch(t){console.error(`âŒ Batch ${e+1} failed:`,t),c.push(`Batch ${e+1}: ${t instanceof Error?t.message:"Unknown error"}`)}}let g=Date.now()-o;return console.log(`âœ… Bulk assignment completed in ${g}ms: ${d} created, ${m} skipped`),i.Z.json({success:!0,message:`Bulk assignment completed: ${d} assignments created`,stats:{totalRequested:t.length,totalCreated:d,totalSkipped:m,totalErrors:c.length,durationMs:g,assignmentsPerSecond:Math.round(d/g*1e3)},errors:c.length>0?c:void 0})}catch(e){return console.error("Bulk assignment error:",e),i.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function u(e,t){let{skipValidation:r=!1,skipExistingCheck:s=!1}=t,a=e;if(!r){let t=Array.from(new Set(e.map(e=>e.maleUserId))),{data:r}=await o.p.from("users").select("id").in("id",t).eq("payment_confirmed",!0).eq("subscription_status","active"),s=new Set(r?.map(e=>e.id)||[]);console.log(`âœ… Validation: ${(a=e.filter(e=>s.has(e.maleUserId))).length}/${e.length} assignments have valid users`)}if(!s&&a.length>0){let{data:e}=await o.p.from("profile_assignments").select("male_user_id, female_user_id"),t=new Set(e?.map(e=>`${e.male_user_id}-${e.female_user_id}`)||[]),r=a.length;console.log(`âœ… Duplicate check: ${(a=a.filter(e=>{let r=`${e.maleUserId}-${e.femaleUserId}`;return!t.has(r)})).length}/${r} assignments are unique`)}if(0===a.length)return{created:0,skipped:e.length,errors:[]};let n=a.map(e=>({male_user_id:e.maleUserId,female_user_id:e.femaleUserId,status:"assigned",male_revealed:!1,female_revealed:!1,assigned_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{data:i,error:l}=await o.p.from("profile_assignments").insert(n).select("id");if(l)throw Error(`Bulk insert failed: ${l.message}`);let u=i?.length||0,d=e.length-u;return{created:u,skipped:d,errors:[]}}async function d(){try{let{data:e}=await o.p.from("profile_assignments").select("status",{count:"exact"}),{data:t}=await o.p.from("users").select("gender, payment_confirmed, subscription_status",{count:"exact"});return i.Z.json({assignmentStats:e||[],userStats:t||[],bulkAssignmentEndpoint:"/api/admin/bulk-assign"})}catch(e){return i.Z.json({error:"Failed to fetch stats"},{status:500})}}let m=a.AppRouteRouteModule,c=new m({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/bulk-assign/route",pathname:"/api/admin/bulk-assign",filename:"route",bundlePath:"app/api/admin/bulk-assign/route"},resolvedPagePath:"/home/aman/Desktop/cufy_3.1v-1/app/api/admin/bulk-assign/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:f,staticGenerationBailout:_}=c,k="/api/admin/bulk-assign/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9195,6886,3433,7221],()=>r(78408));module.exports=s})();